<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.4">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kirill Müller">
<meta name="dcterms.date" content="2024-04-02">
<meta name="description" content="Summarizing the progress of 2022 and 2023">

<title>Recent improvements – R-DBI</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">R-DBI</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../backends/index.html"> 
<span class="menu-text">Backends</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-is-dbi" id="toc-what-is-dbi" class="nav-link active" data-scroll-target="#what-is-dbi">What is DBI?</a></li>
  <li><a href="#overall" id="toc-overall" class="nav-link" data-scroll-target="#overall">Overall</a>
  <ul class="collapse">
  <li><a href="#improve-cicd-infrastructure" id="toc-improve-cicd-infrastructure" class="nav-link" data-scroll-target="#improve-cicd-infrastructure">Improve CI/CD infrastructure</a></li>
  <li><a href="#improve-testing-infrastructure" id="toc-improve-testing-infrastructure" class="nav-link" data-scroll-target="#improve-testing-infrastructure">Improve testing infrastructure</a></li>
  <li><a href="#documentation-improvements" id="toc-documentation-improvements" class="nav-link" data-scroll-target="#documentation-improvements">Documentation improvements</a></li>
  <li><a href="#move-to-cpp11" id="toc-move-to-cpp11" class="nav-link" data-scroll-target="#move-to-cpp11">Move to cpp11</a></li>
  <li><a href="#avoid-tidying-of-duplicate-column-names" id="toc-avoid-tidying-of-duplicate-column-names" class="nav-link" data-scroll-target="#avoid-tidying-of-duplicate-column-names">Avoid tidying of duplicate column names</a></li>
  </ul></li>
  <li><a href="#adbi-new-release-in-collaboration-with-voltron-data" id="toc-adbi-new-release-in-collaboration-with-voltron-data" class="nav-link" data-scroll-target="#adbi-new-release-in-collaboration-with-voltron-data">adbi: new release in collaboration with Voltron Data</a></li>
  <li><a href="#dbi" id="toc-dbi" class="nav-link" data-scroll-target="#dbi">DBI</a>
  <ul class="collapse">
  <li><a href="#integration-with-arrow" id="toc-integration-with-arrow" class="nav-link" data-scroll-target="#integration-with-arrow">Integration with Arrow</a></li>
  <li><a href="#object-identifiers" id="toc-object-identifiers" class="nav-link" data-scroll-target="#object-identifiers">Object identifiers</a></li>
  </ul></li>
  <li><a href="#dbitest" id="toc-dbitest" class="nav-link" data-scroll-target="#dbitest">DBItest</a>
  <ul class="collapse">
  <li><a href="#code-generation" id="toc-code-generation" class="nav-link" data-scroll-target="#code-generation">Code generation</a></li>
  <li><a href="#decoupling-from-backends" id="toc-decoupling-from-backends" class="nav-link" data-scroll-target="#decoupling-from-backends">Decoupling from backends</a></li>
  <li><a href="#other-improvements" id="toc-other-improvements" class="nav-link" data-scroll-target="#other-improvements">Other improvements</a></li>
  </ul></li>
  <li><a href="#backend-packages-rsqlite-rmariadb-rpostgres" id="toc-backend-packages-rsqlite-rmariadb-rpostgres" class="nav-link" data-scroll-target="#backend-packages-rsqlite-rmariadb-rpostgres">Backend packages: RSQLite, RMariaDB, RPostgres</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#acknowledgments" id="toc-acknowledgments" class="nav-link" data-scroll-target="#acknowledgments">Acknowledgments</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Recent improvements</h1>
</div>

<div>
  <div class="description">
    Summarizing the progress of 2022 and 2023
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Kirill Müller </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 2, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="what-is-dbi" class="level2">
<h2 class="anchored" data-anchor-id="what-is-dbi">What is DBI?</h2>
<p>The <a href="https://dbi.r-dbi.org/">DBI package</a> (<strong>d</strong>ata<strong>b</strong>ase <strong>i</strong>nterface) is a layer between R and database management systems (DBMSes). Users who interact with DBMSes via the DBI package are able to use the same API for all DBMSes. Implementations of this API are provided by DBMS-specific <a href="https://github.com/r-dbi/backends#readme">backend packages</a>, such as <a href="https://rpostgres.r-dbi.org/">RPostgres</a>, <a href="https://rmariadb.r-dbi.org/">RMariaDB</a>, and <a href="https://rsqlite.r-dbi.org/">RSQLite</a>. If you are new to DBI, you can find a good entry point in the <a href="https://dbi.r-dbi.org/articles/DBI.html">introductory tutorial</a>.</p>
<p>The interface is designed to be simple and consistent, making it easy to switch between different DBMSes. Packages built on top of DBI, such as <a href="https://dbplyr.tidyverse.org/">dbplyr</a> or <a href="https://docs.ropensci.org/arkdb/">arkdb</a>, provide additional functionality and convenience. New backends can be implemented by following the <a href="https://dbi.r-dbi.org/articles/spec.html">DBI specification</a>, which comes with a comprehensive test suite in the <a href="https://dbitest.r-dbi.org/">DBItest</a> package. The <a href="https://rkazam.r-dbi.org/">RKazam</a> template makes it easy to get started. (Spoiler alert: We know because a new backend has been added recently. Read on!)</p>
<p>This blog post series consists of three parts. In this first part, we summarize recent developments in DBI and related packages, including a glimpse on the new <a href="https://adbi.r-dbi.org/">adbi</a> package. The <a href="https://r-dbi.org/blog/dbi-4-2/">second part</a> reviews the time it takes to respond to issues and pull requests. In the <a href="https://r-dbi.org/blog/dbi-4-3/">third part</a>, we will do a deeper dive into the new adbi and adbcdrivermanager packages, which use the Arrow data exchange format and offer a more sustainable approach to database connectivity.</p>
<p>Similar articles are available from previous years, reporting on earlier states of the DBI ecosystem:</p>
<ul>
<li><a href="https://www.r-dbi.org/blog/dbi-3-3.html">4/4: December 2021</a></li>
<li><a href="https://www.r-dbi.org/blog/dbi-3-3.html">3/4: January 2021</a></li>
<li><a href="https://www.r-dbi.org/blog/dbi-3-2.html">2/4: December 2019</a></li>
<li><a href="https://www.r-dbi.org/blog/dbi-3-1.html">1/4: December 2018</a></li>
</ul>
</section>
<section id="overall" class="level2">
<h2 class="anchored" data-anchor-id="overall">Overall</h2>
<section id="improve-cicd-infrastructure" class="level3">
<h3 class="anchored" data-anchor-id="improve-cicd-infrastructure">Improve CI/CD infrastructure</h3>
<p>Packages run their own checks and the checks for related components. For example, DBI now runs DBItest with RSQLite, and DBItest runs checks for all backends, including odbc. This ensures interoperability between CRAN and development versions of the packages and helps to catch issues early.</p>
<p>Several components simplify the day-to-day work:</p>
<ul>
<li><p><a href="https://www.aviator.co/">Aviator</a> helps ensuring always “green” builds on the main branch.</p>
<p>It is a “click-and-forget” solution that allows queueing a pull request so that it is automatically merged when all checks pass. I’m using this for all my packages now, and it has saved me a lot of time. I also tried the native GitHub merge queue, but it seems to require protecting the main branch, which is required for fledge. 👇</p></li>
<li><p><a href="https://fledge.cynkra.com/">fledge</a> helps automating the release process.</p>
<p>This package generates a changelog from PR titles. In my setup, it is run daily and automatically updates <code>NEWS.md</code>. Before release to CRAN, the changelog is manually converted to release notes. Once a package is on CRAN, a GitHub release is created with these release notes.</p></li>
<li><p>All packages use a similar but not identical setup for CI/CD.</p>
<p>For example, the DBMS installed differs between backends. To manage this and also allow continuous improvement of the CI/CD process, I’m using <a href="https://github.com/krlmlr/actions-sync">bidirectional synchronization</a> to and from a central repository. This allows me to make changes in one of the repositories and have them applied to all other repositories. Among other things, the improved CI/CD workflows automatically open pull requests for changes to autogenerated files such as <code>.Rd</code> files or the results of snapshot tests.</p></li>
</ul>
</section>
<section id="improve-testing-infrastructure" class="level3">
<h3 class="anchored" data-anchor-id="improve-testing-infrastructure">Improve testing infrastructure</h3>
<p>Testing DBI and associated packages often requires a database server. While it is easy enough to install MariaDB and PostgreSQL to run locally, running Oracle and SQL Server on macOS requires Docker. If <em>some</em> databases require Docker, why not run <em>all</em> databases in Docker? This gives the additional advantage of being able to install different versions of the same database server side by side, and to easily recreate a fresh test environment.</p>
<p>The <a href="https://github.com/r-dbi/docker">docker</a> repository aims at providing a consistent and easy-to-use setup for all databases and all packages. It uses Docker Compose to turn otherwise complex command line invocations into a single <code>docker-compose</code> command. The goals are:</p>
<ul>
<li><p>Have a single robust command to create a server and a test connection, testable with CI/CD.</p></li>
<li><p>Offer an easy way to run tests or scripts against a particular database server, using a development version of a backend package.</p></li>
<li><p>Support testing all useful combinations of DBI backend and database server.</p></li>
<li><p>Make it easy to add new database versions, new databases, and new backends.</p></li>
</ul>
<p>The repository is still in its early stages, but it already supports MariaDB, MySQL, PostgreSQL, SQLite, SQL Server, and Oracle. Feedback and contributions are welcome.</p>
</section>
<section id="documentation-improvements" class="level3">
<h3 class="anchored" data-anchor-id="documentation-improvements">Documentation improvements</h3>
<p>Various documentation improvements have been made:</p>
<ul>
<li><p>The DBI specification is now version-controlled as Markdown files. This allows for more control and a simpler build process. Previously has been assembled at package build time from various sources.</p></li>
<li><p>The command execution and data retrieval flow has been clarified in the documentation. This has been a common source of confusion for new users.</p></li>
<li><p>All packages now use the new pkgdown documentation template at <a href="https://github.com/r-dbi/dbitemplate" class="uri">https://github.com/r-dbi/dbitemplate</a>, and the website at <a href="https://r-dbi.org" class="uri">https://r-dbi.org</a> is now built using Quarto. Thanks to Maëlle Salmon (<a href="https://github.com/maelle">@maelle</a>)!</p></li>
</ul>
</section>
<section id="move-to-cpp11" class="level3">
<h3 class="anchored" data-anchor-id="move-to-cpp11">Move to cpp11</h3>
<p>The RSQLite, RPostgres, and RMariaDB packages are now using the <a href="https://cpp11.r-lib.org/">cpp11</a> package for the glue between R and C++. This header-only package provides a modern C++11 interface to R, the header files can be vendored into the backend packages if needed. Other highlights include the use “UTF-8 everywhere” paradigm, improved safety of C API calls, and a faster implementation of protection.</p>
</section>
<section id="avoid-tidying-of-duplicate-column-names" class="level3">
<h3 class="anchored" data-anchor-id="avoid-tidying-of-duplicate-column-names">Avoid tidying of duplicate column names</h3>
<p>The RSQLite, RPostgres, and RMariaDB packages no longer change duplicate column names. The behavior in the presence of duplicate column names was not specified in the DBI specification, but imposing a tidying step seems out of scope for a database interface. It is now up to the user to handle duplicate column names, for example by using <code>janitor::clean_names()</code>.</p>
</section>
</section>
<section id="adbi-new-release-in-collaboration-with-voltron-data" class="level2">
<h2 class="anchored" data-anchor-id="adbi-new-release-in-collaboration-with-voltron-data">adbi: new release in collaboration with Voltron Data</h2>
<p>The new adbi package bridges ADBC drivers and DBI. Examples include:</p>
<ul>
<li><a href="https://arrow.apache.org/adbc/current/r/adbcsqlite/">adbcsqlite</a>, on CRAN</li>
<li><a href="https://arrow.apache.org/adbc/current/r/adbcpostgresql/">adbcpostgresql</a>, on CRAN</li>
<li><a href="https://github.com/apache/arrow-adbc/tree/main/r/adbcsnowflake">adbcsnowflake</a> for <a href="https://www.snowflake.com/">Snowflake</a></li>
<li><a href="https://github.com/apache/arrow-adbc/tree/main/r/adbcflightsql">adbcflightsql</a> for <a href="https://arrow.apache.org/docs/format/FlightSql.html">FlightSQL</a></li>
<li><a href="https://duckdb.org/docs/api/r">duckdb</a>, which implements an ADBC driver in addition to the DBI backend</li>
</ul>
<p><a href="https://arrow.apache.org/adbc/">ADBC</a> (Arrow database connectivity) is</p>
<blockquote class="blockquote">
<p>an API standard for database access libraries that uses Arrow for result sets and query parameters.</p>
</blockquote>
<p>The adbi package allows existing code that uses DBI to seamlessly interact with the new ADBC drivers, but this will not improve performance. To facilitate the switch to using Arrow as a data interchange format, adbi supports access via data frames and Arrow side by side, on the same connection object, using the new generics defined by DBI. For example, with <code>dbGetQueryArrow()</code>, the result set is passed to R as an Arrow stream, bypassing the expensive conversion to data frames. More on that below.</p>
<p>Development of the adbi package has been made easy with the RKazam package, which is a template for creating DBI backends, and the DBItest package, which provides a battery of tests that all “pass” with the package generated from the template and help guide the development process. Thanks to Nicolas Bennett (<a href="https://github.com/nbenn">@nbenn</a>) for the implementation and the wonderful collaboration, and to <a href="https://voltrondata.com/">Voltron Data</a> for supporting this effort.</p>
</section>
<section id="dbi" class="level2">
<h2 class="anchored" data-anchor-id="dbi">DBI</h2>
<p>This package has seen a minor update to 1.2.2. See the <a href="https://dbi.r-dbi.org/news/index.html">change log</a> for the full details.</p>
<section id="integration-with-arrow" class="level3">
<h3 class="anchored" data-anchor-id="integration-with-arrow">Integration with Arrow</h3>
<p>DBI backens can now optionally support Arrow arrays and streams as the primary data exchange format. This is accessed through the new generics <code>dbSendQueryArrow()</code>, <code>dbFetchArrow()</code>, <code>dbFetchArrowChunk()</code>, <code>dbGetQueryArrow()</code>, <code>dbReadTableArrow()</code>, <code>dbWriteTableArrow()</code>, <code>dbCreateTableArrow()</code>, <code>dbAppendTableArrow()</code>, and <code>dbBindArrow()</code>. See the new <a href="https://dbi.r-dbi.org/articles/DBI-arrow.html">vignette on Arrow support in DBI</a> for details.</p>
<p>A default implementation is provided in the DBI package, this means that the new interface can be used with any DBI backend without changes to the backend package. Performance and interoperability gains can be achieved by directly implementing the Arrow interface in the backend package, as the new adbi package does.</p>
<p>The following example illustrates two options to connect with a PostgreSQL database. In both scenarios, the libpq library is used to communicate with the database server. The RPostgres package links to libpq, the PostgreSQL client library, and uses this API directly to retrieve and ingest data from R via the DBI interface. The adbcpostgresql package also links to libpq but exposes ADBC, which is brought to R with the adbcdrivermanager package. On top of that, the adbi package interacts with arbitrary ADBC drivers (including adbcpostgresql) and exposes the functionality through DBI. The R user has the choice to access the data via data frames or via Arrow. When using adbi and the new <code>dbGetQueryArrow()</code>, the implementation will never convert the data to R data frames. This allows, e.g., directly saving the result to a Parquet file, or further processing it with Arrow. In all other cases, a conversion to R data frames will occur.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="adbi.png" class="img-fluid figure-img" alt="Space divided into two areas, R data frames at the left, Arrow at the right. Two concurrent data flows from libpq to DBI are shown: one via RPostgres through R data frames, one via adbcpostgresql and adbi through Arrow. The two flows merge at the DBI layer. From DBI, consumers can use dbGetQuery() to get data frames, or dbGetQueryArrow() to get Arrow streams."></p>
<figcaption>Data flow from libpq to consumers</figcaption>
</figure>
</div>
<p>While the Arrow path seems to involve more components, it is the most efficient way to interact with the database because the data is threaded through from adbcpostgresql to R without any conversion or even copying. The only conversion occurs in adbcpostgresql, when the data returned by libpq is converted to Arrow format.</p>
<p>With FlightSQL, the data will be passed in the Arrow format end to end, this requires support in the database <em>server</em>. This is a promising development. By using adbi or adbcdrivermanager, R users can seamlessly transition to FlightSQL when it becomes available in their database.</p>
<p>Thanks to <a href="https://voltrondata.com/">Voltron Data</a> for supporting this effort!</p>
</section>
<section id="object-identifiers" class="level3">
<h3 class="anchored" data-anchor-id="object-identifiers">Object identifiers</h3>
<p>The <code>Id()</code> class has been changed to unnamed components, as the explicit naming of the components (“database”, “schema”, “table”) was not used in practice. This also affects the <code>dbQuoteIdentifier()</code>, <code>dbUnquoteIdentifier()</code>, and <code>dbListObjects()</code> generics, which now accept and return unnamed <code>Id()</code> objects.</p>
</section>
</section>
<section id="dbitest" class="level2">
<h2 class="anchored" data-anchor-id="dbitest">DBItest</h2>
<p>The DBItest package has seen a minor update to 1.8.1. See the <a href="https://dbitest.r-dbi.org/news/index.html">change log</a> for details.</p>
<section id="code-generation" class="level3">
<h3 class="anchored" data-anchor-id="code-generation">Code generation</h3>
<p><a href="https://mtlynch.io/good-developers-bad-tests/">Why good developers write bad unit tests</a>? In a nutshell, production code should avoid repetition and hard-coded constant, while testing code should be as explicit and as easy to understand and execute as possible.</p>
<p>The DBItest package is home to both the specification of the DBI package and a test suite for DBI backends. As such, good software engineering practices are actually useful here and have helped cover many corner cases in the DBI backends. Running the tests in DBItest is easy, but in the case of a failure, the error messages are not always helpful. Backend developers typically have to read the test code to understand what went wrong. And if the actual test code hides between layers of abstraction, this can be a daunting task.</p>
<p>Code generation has proved to be a powerful tool to peel off abstraction layers, for instance in the <a href="https://duckdblabs.github.io/duckplyr/">duckplyr</a> project. In R, code is data, and the language and the associated packages are very well suited for this task. The long-term goal is to turn DBItest into a <em>code generator</em> rather than a <em>test executor</em>: the test code will be generated from a specification directly into the backend package and executed there. In the case of a failure, the error message will point to the generated code and to the relevant part of the specification. Failing tests can be executed trivially, very much like failures in regular tests. The expected behavior becomes apparent from the generated code, leading to a better understanding of the failure and a more efficient debugging process.</p>
<p>A first step has been taken in this direction, the tests for the command execution and data retrieval flows via <code>dbBind()</code> have been refactored to generate inline code in the DBItest package. The process towards full code generation requires similar steps in a few other places to avoid hard-to-understand generated code, which would be even worse than the current situation.</p>
</section>
<section id="decoupling-from-backends" class="level3">
<h3 class="anchored" data-anchor-id="decoupling-from-backends">Decoupling from backends</h3>
<p>As DBItest continues to evolve, and more backends are using it, the ability to add or update checks without affecting all downstream packages becomes crucial. Each new or modified test will require the backend package to opt in by updating the DBItest version in their <code>tweaks()</code> call. Once the code generation is in place, this will become less of an issue, but for now this helps with the ongoing development.</p>
</section>
<section id="other-improvements" class="level3">
<h3 class="anchored" data-anchor-id="other-improvements">Other improvements</h3>
<p>The new Arrow generics are now tested in DBItest, and the tests have been integrated into the CI/CD pipeline.</p>
<p>A new tweak <code>allow_na_rows_affected</code> has been added to support <code>NA</code> values returned from <code>dbGetRowsAffected()</code> and passed as the <code>n</code> argument to <code>dbFetch()</code>.</p>
</section>
</section>
<section id="backend-packages-rsqlite-rmariadb-rpostgres" class="level2">
<h2 class="anchored" data-anchor-id="backend-packages-rsqlite-rmariadb-rpostgres">Backend packages: RSQLite, RMariaDB, RPostgres</h2>
<ul>
<li><p>RSQLite has seen a minor update, the current version is 2.3.6. See the <a href="https://rsqlite.r-dbi.org/news/index.html">change log</a> for details.</p>
<p>The automatic update of the bundled SQLite library has enabled continuous and timely updates of the RSQLite package on CRAN. The latest version of SQLite is 3.45.2, and the RSQLite package is now bundling it. For this reason, the known authors of SQLite have been added to the <code>DESCRIPTION</code> file. This process allows quicker updates of SQLite than if installing from <a href="https://repology.org/project/sqlite/versions">OS package repositories</a>, and precise control of the underlying SQLite version used in a project.</p>
<p>Other minor changes include support for the icpc compiler, and a new <code>sqliteIsTransacting()</code> function that returns if a transaction is active on the current connection.</p></li>
<li><p>RMariaDB has also seen a minor update. The current version is 1.3.1. See the <a href="https://rmariadb.r-dbi.org/news/index.html">change log</a> for details.</p>
<p>MariaDB is a fork of MySQL, and both packages continue to evolve. There are small but important differences between the two DBMSs, and the RMariaDB package is now more explicit about the differences. Connections now inherit from <code>"MySQLConnection"</code> if a MySQL server is detected (server version &lt; 10.0 and server description does not contain <code>"MariaDB"</code>). The new <code>mysql</code> argument to <code>dbConnect()</code> allows overriding the autodetection. This means that code can behave differently depending on the underlying database server.</p>
<p>Similarly to RPostgres and odbc, RMariaDB now supports <code>dbSendStatement(immediate = TRUE)</code> and <code>dbExecute(immediate = TRUE)</code>. This sends the query to the server without preparing it, which is mandatory for some queries. For this to work, the connection needs to be opened with the <code>CLIENT_MULTI_STATEMENTS</code> flag.</p>
<p>Other changes include:</p>
<ul>
<li><p>Support for <code>TIME</code> columns with subsecond precision.</p></li>
<li><p>The use of strings as default for JSON and all unknown column types.</p></li>
</ul></li>
<li><p>RPostgres has seen a minor update, mostly focusing on maintenance. The current version is 1.4.6. See the <a href="https://rpostgres.r-dbi.org/news/index.html">change log</a> for details.</p></li>
</ul>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Quite a few things have happened in the DBI ecosystem since the last blog post. Try out the new package versions, let us know if they work for you, and report any problems you encounter in the respective issue trackers on GitHub. Happy querying!</p>
</section>
<section id="acknowledgments" class="level2">
<h2 class="anchored" data-anchor-id="acknowledgments">Acknowledgments</h2>
<p>Thanks to Maëlle Salmon (<a href="https://github.com/maelle">@maelle</a>) and Nicolas Bennett (<a href="https://github.com/nbenn">@nbenn</a>) for their help with the blog post, and to the numerous contributors to the packages in the “Maintaining DBI” project in 2022 and 2023:</p>
<ul>
<li><p>DBI: <a href="https://github.com/apalacio9502">@apalacio9502</a>, <a href="https://github.com/asadow">@asadow</a>, <a href="https://github.com/bcorwin">@bcorwin</a>, <a href="https://github.com/capitantyler">@capitantyler</a>, <a href="https://github.com/chrisdane">@chrisdane</a>, <a href="https://github.com/eauleaf">@eauleaf</a>, <a href="https://github.com/eitsupi">@eitsupi</a>, <a href="https://github.com/eriksquires">@eriksquires</a>, <a href="https://github.com/fnavarro94">@fnavarro94</a>, <a href="https://github.com/GitHunter0">@GitHunter0</a>, <a href="https://github.com/hadley">@hadley</a>, <a href="https://github.com/hannes101">@hannes101</a>, <a href="https://github.com/Jay123ub">@Jay123ub</a>, <a href="https://github.com/jd4ds">@jd4ds</a>, <a href="https://github.com/kelseyroberts">@kelseyroberts</a>, <a href="https://github.com/latot">@latot</a>, <a href="https://github.com/maelle">@maelle</a>, <a href="https://github.com/matthiasgomolka">@matthiasgomolka</a>, <a href="https://github.com/mgirlich">@mgirlich</a>, <a href="https://github.com/mmuurr">@mmuurr</a>, <a href="https://github.com/nbenn">@nbenn</a>, <a href="https://github.com/philibe">@philibe</a>, <a href="https://github.com/pnacht">@pnacht</a>, <a href="https://github.com/r2evans">@r2evans</a>, <a href="https://github.com/renkun-ken">@renkun-ken</a>, <a href="https://github.com/salim-b">@salim-b</a>, <a href="https://github.com/scottfrechette">@scottfrechette</a>, and <a href="https://github.com/tzakharko">@tzakharko</a>.</p></li>
<li><p>DBItest: <a href="https://github.com/barracuda156">@barracuda156</a>, <a href="https://github.com/detule">@detule</a>, <a href="https://github.com/dpprdan">@dpprdan</a>, <a href="https://github.com/hadley">@hadley</a>, <a href="https://github.com/maelle">@maelle</a>, <a href="https://github.com/MichaelChirico">@MichaelChirico</a>, <a href="https://github.com/nbenn">@nbenn</a>, <a href="https://github.com/psychelzh">@psychelzh</a>, and <a href="https://github.com/TSchiefer">@TSchiefer</a>.</p></li>
<li><p>RSQLite: <a href="https://github.com/Antonov548">@Antonov548</a>, <a href="https://github.com/arnaud-feldmann">@arnaud-feldmann</a>, <a href="https://github.com/bpvgoncalves">@bpvgoncalves</a>, <a href="https://github.com/chodarq">@chodarq</a>, <a href="https://github.com/Daniel-Zhou-93">@Daniel-Zhou-93</a>, <a href="https://github.com/DavorJ">@DavorJ</a>, <a href="https://github.com/eriksquires">@eriksquires</a>, <a href="https://github.com/gaospecial">@gaospecial</a>, <a href="https://github.com/gavril0">@gavril0</a>, <a href="https://github.com/github-actions%5Bbot%5D">@github-actions[bot]</a>, <a href="https://github.com/hadley">@hadley</a>, <a href="https://github.com/IdoBar">@IdoBar</a>, <a href="https://github.com/JeremyPasco">@JeremyPasco</a>, <a href="https://github.com/joethorley">@joethorley</a>, <a href="https://github.com/kjellpk">@kjellpk</a>, <a href="https://github.com/kmishra9">@kmishra9</a>, <a href="https://github.com/krlmlr">@krlmlr</a>, <a href="https://github.com/lolow">@lolow</a>, <a href="https://github.com/maelle">@maelle</a>, <a href="https://github.com/MichaelChirico">@MichaelChirico</a>, <a href="https://github.com/nathaneastwood">@nathaneastwood</a>, <a href="https://github.com/nunotexbsd">@nunotexbsd</a>, <a href="https://github.com/RoganGrant">@RoganGrant</a>, <a href="https://github.com/SarenT">@SarenT</a>, <a href="https://github.com/stephenashton-dhsc">@stephenashton-dhsc</a>, <a href="https://github.com/wibeasley">@wibeasley</a>, and <a href="https://github.com/xmart">@xmart</a>.</p></li>
<li><p>RPostgres: <a href="https://github.com/abalter">@abalter</a>, <a href="https://github.com/ablack3">@ablack3</a>, <a href="https://github.com/agilly">@agilly</a>, <a href="https://github.com/aliarsalankazmi">@aliarsalankazmi</a>, <a href="https://github.com/ankane">@ankane</a>, <a href="https://github.com/Antonov548">@Antonov548</a>, <a href="https://github.com/bhogan-mitre">@bhogan-mitre</a>, <a href="https://github.com/castagninojose">@castagninojose</a>, <a href="https://github.com/DavisVaughan">@DavisVaughan</a>, <a href="https://github.com/dmkaplan2000">@dmkaplan2000</a>, <a href="https://github.com/dpprdan">@dpprdan</a>, <a href="https://github.com/geneorama">@geneorama</a>, <a href="https://github.com/gui-salome">@gui-salome</a>, <a href="https://github.com/ilarischeinin">@ilarischeinin</a>, <a href="https://github.com/jeroen">@jeroen</a>, <a href="https://github.com/karawoo">@karawoo</a>, <a href="https://github.com/kevinpalm">@kevinpalm</a>, <a href="https://github.com/kmishra9">@kmishra9</a>, <a href="https://github.com/maelle">@maelle</a>, <a href="https://github.com/majazaloznik">@majazaloznik</a>, <a href="https://github.com/meztez">@meztez</a>, <a href="https://github.com/mgirlich">@mgirlich</a>, <a href="https://github.com/mmuurr">@mmuurr</a>, <a href="https://github.com/nbenn">@nbenn</a>, <a href="https://github.com/pachadotdev">@pachadotdev</a>, <a href="https://github.com/pedrobtz">@pedrobtz</a>, <a href="https://github.com/samterfa">@samterfa</a>, <a href="https://github.com/sbamin">@sbamin</a>, <a href="https://github.com/stefan-m-lenz">@stefan-m-lenz</a>, and <a href="https://github.com/veer0318">@veer0318</a>.</p></li>
<li><p>RMariaDB: <a href="https://github.com/Antonov548">@Antonov548</a>, <a href="https://github.com/arecibo">@arecibo</a>, <a href="https://github.com/bergernetch">@bergernetch</a>, <a href="https://github.com/BillWeld">@BillWeld</a>, <a href="https://github.com/cboettig">@cboettig</a>, <a href="https://github.com/d-hansen">@d-hansen</a>, <a href="https://github.com/EllyJung">@EllyJung</a>, <a href="https://github.com/frabau1">@frabau1</a>, <a href="https://github.com/ghost">@ghost</a>, <a href="https://github.com/GitHunter0">@GitHunter0</a>, <a href="https://github.com/GraphZal">@GraphZal</a>, <a href="https://github.com/GundryLab">@GundryLab</a>, <a href="https://github.com/hpages">@hpages</a>, <a href="https://github.com/jay-sf">@jay-sf</a>, <a href="https://github.com/jd4ds">@jd4ds</a>, <a href="https://github.com/jeroen">@jeroen</a>, <a href="https://github.com/KevinYie">@KevinYie</a>, <a href="https://github.com/kwakuduahc1">@kwakuduahc1</a>, <a href="https://github.com/lbui30">@lbui30</a>, <a href="https://github.com/LeeMendelowitz">@LeeMendelowitz</a>, <a href="https://github.com/LukeBla">@LukeBla</a>, <a href="https://github.com/maelle">@maelle</a>, <a href="https://github.com/mbarneytu">@mbarneytu</a>, <a href="https://github.com/mgirlich">@mgirlich</a>, <a href="https://github.com/MySocialPulse">@MySocialPulse</a>, <a href="https://github.com/NoProblemJack">@NoProblemJack</a>, <a href="https://github.com/pekkarr">@pekkarr</a>, <a href="https://github.com/psychelzh">@psychelzh</a>, <a href="https://github.com/pythiantech">@pythiantech</a>, <a href="https://github.com/renkun-ken">@renkun-ken</a>, <a href="https://github.com/rorynolan">@rorynolan</a>, <a href="https://github.com/ryan-hdez">@ryan-hdez</a>, <a href="https://github.com/SwissMontainsBear">@SwissMontainsBear</a>, <a href="https://github.com/uhkeller">@uhkeller</a>, and <a href="https://github.com/vanhry">@vanhry</a>.</p></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/r-dbi\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="r-dbi/r-dbi.org" data-repo-id="R_kgDOJfIb7Q" data-category="General" data-category-id="DIC_kwDOJfIb7c4Ceucb" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 © Licence MIT.
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://www.r-consortium.org/">
<p>Sponsored by the R Consortium.</p>
</a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>